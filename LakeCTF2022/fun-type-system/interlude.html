<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Interlude: The deobfuscated code - Fun type system</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Lake CTF 2022</li><li class="chapter-item expanded "><a href="../../LakeCTF2022/fun-type-system/statement.html"><strong aria-hidden="true">1.</strong> fun type system</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../LakeCTF2022/fun-type-system/part-1/intro.html"><strong aria-hidden="true">1.1.</strong> Part 1: The first rev</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../LakeCTF2022/fun-type-system/part-1/section-1.html"><strong aria-hidden="true">1.1.1.</strong> First steps</a></li><li class="chapter-item expanded "><a href="../../LakeCTF2022/fun-type-system/part-1/section-2.html"><strong aria-hidden="true">1.1.2.</strong> Knocking down the easy ones first</a></li><li class="chapter-item expanded "><a href="../../LakeCTF2022/fun-type-system/part-1/section-3.html"><strong aria-hidden="true">1.1.3.</strong> Functions on lists</a></li><li class="chapter-item expanded "><a href="../../LakeCTF2022/fun-type-system/part-1/section-4.html"><strong aria-hidden="true">1.1.4.</strong> Finding the integers</a></li><li class="chapter-item expanded "><a href="../../LakeCTF2022/fun-type-system/part-1/section-5.html"><strong aria-hidden="true">1.1.5.</strong> Wait, there's a tree?</a></li><li class="chapter-item expanded "><a href="../../LakeCTF2022/fun-type-system/part-1/section-6.html"><strong aria-hidden="true">1.1.6.</strong> The Lake</a></li></ol></li><li class="chapter-item expanded "><a href="../../LakeCTF2022/fun-type-system/interlude.html" class="active"><strong aria-hidden="true">1.2.</strong> Interlude: The deobfuscated code</a></li><li class="chapter-item expanded "><a href="../../LakeCTF2022/fun-type-system/part-2/intro.html"><strong aria-hidden="true">1.3.</strong> Part 2: The second rev</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../LakeCTF2022/fun-type-system/part-2/section-1.html"><strong aria-hidden="true">1.3.1.</strong> The first check</a></li><li class="chapter-item expanded "><a href="../../LakeCTF2022/fun-type-system/part-2/section-2.html"><strong aria-hidden="true">1.3.2.</strong> The second check</a></li><li class="chapter-item expanded "><a href="../../LakeCTF2022/fun-type-system/part-2/section-3.html"><strong aria-hidden="true">1.3.3.</strong> The third check</a></li></ol></li><li class="chapter-item expanded "><a href="../../LakeCTF2022/fun-type-system/part-3/intro.html"><strong aria-hidden="true">1.4.</strong> Part 3: The solution</a></li></ol></li><li class="chapter-item expanded "><a href="../../LakeCTF2022/others.html"><strong aria-hidden="true">2.</strong> ...</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Fun type system</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="interlude-the-deobfuscated-code"><a class="header" href="#interlude-the-deobfuscated-code">Interlude: The deobfuscated code</a></h1>
<p>Before we find the solution, I'll post the final deobfuscated <code>Main.scala</code> file
that we built in the process</p>
<pre><code class="language-scala">
@main
def main(args: String*) = println(&quot;much types, such recursion&quot;)

// Make me compile ;)
// Be patient, a successful compile takes 350s on my laptop.

// THIS IS THE ONLY LINE YOU HAVE TO CHANGE!
// if the flag were FLAG, enter it like this:
type Flag = CharF =~: CharL =~: CharA =~: CharG =~: EOS // keep the EOS at the end

// Use these (and only these) in the flag
type CharNul = ZeroByte
type CharA = ByteAdd[CharNul, OneByte]
type CharB = ByteAdd[CharA, OneByte]
type CharC = ByteAdd[CharB, OneByte]
type CharD = ByteAdd[CharC, OneByte]
type CharE = ByteAdd[CharD, OneByte]
type CharF = ByteAdd[CharE, OneByte]
type CharG = ByteAdd[CharF, OneByte]
type CharH = ByteAdd[CharG, OneByte]
type CharI = ByteAdd[CharH, OneByte]
type CharJ = ByteAdd[CharI, OneByte]
type CharK = ByteAdd[CharJ, OneByte]
type CharL = ByteAdd[CharK, OneByte]
type CharM = ByteAdd[CharL, OneByte]
type CharN = ByteAdd[CharM, OneByte]
type CharO = ByteAdd[CharN, OneByte]
type CharP = ByteAdd[CharO, OneByte]
type CharQ = ByteAdd[CharP, OneByte]
type CharR = ByteAdd[CharQ, OneByte]
type CharS = ByteAdd[CharR, OneByte]
type CharT = ByteAdd[CharS, OneByte]
type CharU = ByteAdd[CharT, OneByte]
type CharV = ByteAdd[CharU, OneByte]
type CharW = ByteAdd[CharV, OneByte]
type CharX = ByteAdd[CharW, OneByte]
type CharY = ByteAdd[CharX, OneByte]
type CharZ = ByteAdd[CharY, OneByte]
// end of alphabet

type VictoryCondition = Lake[Leka[FourthToTop], Concat[Flag, CharNul =~: EOS], Leka[&quot;main&quot;] =~: EOS, NewTree[ZeroByte, 8], Leka] =:= (I[20] =~: EOS)

sealed trait Push[X]          
sealed trait OnBit              
sealed trait Pop                      
sealed trait AddInstr           
sealed trait Node[X]   
sealed trait SubInstr                    

type ByteAdd[X, Y] = ByteAddWithCarry[X, Y, OffBit]

type Map[L, F[_]] = L match
  case EOS =&gt; EOS
  case h =~: t =&gt; F[h] =~: Map[t, F]

type Fold[L, Z, F[_, _]] = L match
  case EOS =&gt; Z
  case h =~: t =&gt; F[h, Fold[t, Z, F]]

type Concat[L, R] = Fold[L, R, [h, t] =&gt;&gt; h =~: t]

type ZeroByte = OffBit =~: OffBit =~: OffBit =~: OffBit =~: OffBit =~: OffBit =~: OffBit =~: OffBit =~: EOS

type I[X] = IntToBitstring[X, 8]

import scala.compiletime.ops.int.S
type Extend[X, I] = I match
  case 0 =&gt; EOS
  case S[n] =&gt; X match
    case EOS      =&gt; OffBit =~: Extend[X, n]
    case h =~: EOS =&gt; h =~: Extend[X, n]
    case h =~: t   =&gt; h =~: Extend[t, n]

type K[X] = X match
  case 0 =&gt; BitstringZero
  case S[n] =&gt; BitstringAddWithCarry[I[n], BistringOne, OffBit]

type BitstringAddWithCarry[X, Y, C] = (X, Y) match
  case (x =~: EOS, y =~: EOS) =&gt; BitAddWithCarry[x, y, C] match
    case (res, carry) =&gt; res =~: carry =~: EOS
  case (X, y =~: EOS) =&gt; BitstringAddWithCarry[X, y =~: OffBit =~: EOS, C]
  case (x =~: EOS, Y) =&gt; BitstringAddWithCarry[x =~: OffBit =~: EOS, Y, C]
  case (xh =~: xt, yh =~: yt) =&gt; BitAddWithCarry[xh, yh, C] match
    case (res, carry) =&gt; res =~: BitstringAddWithCarry[xt, yt, carry]

sealed trait XorInstr             
sealed trait OffBit
sealed trait Call[Bean]
sealed trait Jump[Smad]              
sealed trait Pair[L, R]

type BitAddWithCarry[X, Y, C] = X match
  case OffBit =&gt; Y match
    case OffBit =&gt; C match
      case OffBit =&gt; (OffBit, OffBit)
      case OnBit =&gt; (OnBit, OffBit)
    case OnBit =&gt; C match
      case OffBit =&gt; (OnBit, OffBit)
      case OnBit =&gt; (OffBit, OnBit)
  case OnBit =&gt; Y match    
    case OffBit =&gt; C match
      case OffBit =&gt; (OnBit, OffBit)
      case OnBit =&gt; (OffBit, OnBit)
    case OnBit =&gt; C match
      case OffBit =&gt; (OffBit, OnBit)
      case OnBit =&gt; (OnBit, OnBit)

type BitstringZero = OffBit =~: EOS

type ReplaceNodeElement[T, N, X] = N match
  case EOS =&gt; T match
    case Node[x] =&gt; Node[X]
  case OffBit =~: bs =&gt; T match
    case Pair[l, r] =&gt; Pair[ReplaceNodeElement[l, bs, X], r]
  case OnBit =~: bs =&gt; T match
    case Pair[l, r] =&gt; Pair[l, ReplaceNodeElement[r, bs, X]]

type ByteAddWithCarry[X, Y, C] = (X, Y) match
  case (x =~: EOS, y =~: EOS) =&gt; BitAddWithCarry[x, y, C] match
    case (res, carry) =&gt; res =~: EOS
  case (xh =~: xt, yh =~: yt) =&gt; BitAddWithCarry[xh, yh, C] match
    case (res, carry) =&gt; res =~: ByteAddWithCarry[xt, yt, carry]

type ByteSub[X, Y] = ByteAdd[X, ByteAdd[Map[Y, Not], OneByte]]


sealed trait EOS
sealed trait JumpIfZero[Diplodocus]         
sealed trait Return                   
sealed trait =~:[Compare, To]
sealed trait Load             
sealed trait Store          
sealed trait DoubleHead                                      
sealed trait Exit     

type Not[X] = X match
  case OffBit =&gt; OnBit
  case OnBit =&gt; OffBit

type OneByte = OnBit =~: OffBit =~: OffBit =~: OffBit =~: OffBit =~: OffBit =~: OffBit =~: OffBit =~: EOS

type Xor[X, Y] = X match
  case EOS =&gt; EOS
  case OffBit =~: x =&gt; Y match
    case b =~: y =&gt; b =~: Xor[x, y]
  case OnBit =~: x =&gt; Y match
    case b =~: y =&gt; Not[b] =~: Xor[x, y]

type IfZero[X, T, F] = X match
  case OffBit =~: EOS =&gt; T
  case OffBit =~: t =&gt; IfZero[t, T, F]
  case OnBit =~: t =&gt; F

type IntToBitstring[X, Size] = Extend[K[X], Size]

type Lake[Instructions, Stack, Frames, Tree, Func[_]] = Instructions match
  case EOS =&gt; (Stack, Tree)
  case data1 =~: data2 =&gt; data1 match
    case Push[x] =&gt; Lake[data2, x =~: Stack, Frames, Tree, Func]
    case Pop =&gt; Stack match
      case smoothLike =~: butter =&gt; Lake[data2, butter, Frames, Tree, Func]
    case AddInstr =&gt; Stack match
      case bing =~: sucks =~: lmao =&gt; Lake[data2, ByteAdd[sucks, bing] =~: lmao, Frames, Tree, Func]
    case SubInstr =&gt; Stack match
      case owo =~: qwq =~: uwu =&gt; Lake[data2, ByteSub[qwq, owo] =~: uwu, Frames, Tree, Func]
    case XorInstr =&gt; Stack match
      case math =~: too =~: hard =&gt; Lake[data2, Xor[too, math] =~: hard, Frames, Tree, Func]
    case Call[x] =&gt; Lake[Func[x], Stack, data2 =~: Frames, Tree, Func]
    case Jump[localsCount] =&gt; Lake[Func[localsCount], Stack, Frames, Tree, Func]
    case JumpIfZero[roar] =&gt; Stack match
      case suchPredator =~: muchMonch =&gt; 
        IfZero[
          suchPredator,
          Magick[Lake[Func[roar], muchMonch, Frames, Tree, Func]]#trick,
          Magick[Lake[data2, muchMonch, Frames, Tree, Func]]#trick,
        ]
    case Return =&gt; Frames match
      case bigL =~: plusRatio =&gt; Lake[bigL, Stack, plusRatio, Tree, Func]
    case Load =&gt; Stack match
      case comeOn =~: waitFaster =&gt; Lake[data2, GetNodeElement[Memory, comeOn] =~: waitFaster, Frames, Memory, Func]
    case Store =&gt; Stack match
      case miam =~: withHummus =~: andCucumber =&gt; Lake[data2, andCucumber, Frames, ReplaceNodeElement[Memory, miam, withHummus], Func]
    case DoubleHead =&gt; Stack match
      case flag =~: checker  =&gt; Lake[data2, flag =~: flag =~: checker, Frames, Memory, Func]
    case SecondToTop =&gt; Stack match
      case                     aaaaaaa =~: aaaaaa =~: aaaaa =&gt; Lake[data2, aaaaaa =~: aaaaaaa =~: aaaaa, Frames, Memory, Func]
    case ThirdToTop =&gt; Stack match
      case         aaaaaaa =~: aaaaaa =~: aaaaaaaa =~: aaaaa =&gt; Lake[data2, aaaaaaaa =~: aaaaaaa =~: aaaaaa =~: aaaaa, Frames, Memory, Func]
    case FourthToTop =&gt; Stack match
      case aaaaaaa =~: aaaaaa =~: aaaaaaaa =~: aaaa =~: aaaaa =&gt; Lake[data2, aaaa =~: aaaaaaa =~: aaaaaa =~: aaaaaaaa =~: aaaaa, Frames, Memory, Func]
    case Exit =&gt; Stack

type NewTree[X, N] = N match
  case 0 =&gt; Node[X]
  case S[n] =&gt; Pair[NewTree[X, n], NewTree[X, n]]

type BistringOne = OnBit =~: EOS

type Leka[X] = X match
  case SecondToTop =&gt;
    DoubleHead =~:
    Load =~:
    JumpIfZero[&quot;recurse-trampoline&quot;] =~:
    Push[I[1]] =~:
    AddInstr =~:
    SecondToTop =~:
    Push[I[1]] =~:
    AddInstr =~:
    SecondToTop =~:
    Jump[SecondToTop] =~:
    EOS
  case ThirdToTop =&gt;
    DoubleHead =~:
    ThirdToTop =~:
    AddInstr =~:
    SecondToTop =~:
    Load =~:
    SecondToTop =~:
    Store =~:
    Return =~:
    EOS
  case FourthToTop =&gt;
    Push[I[42]] =~:
    Call[Pop] =~:
    Push[I[0]] =~:
    Push[I[42]] =~:
    Call[SecondToTop] =~:
    Push[I[8]] =~:
    SubInstr =~:
    JumpIfZero[&quot;stacktrace&quot;] =~:
    Push[I[0]] =~:
    Exit =~:
    EOS
  case CharE =&gt;
    Pop =~:
    Pop =~:
    Pop =~:
    Return =~:
    EOS
  case CharP =&gt;
    Push[I[1]] =~:
    AddInstr =~:
    SecondToTop =~:
    Push[I[1]] =~:
    AddInstr =~:
    ThirdToTop =~:
    Push[I[1]] =~:
    SubInstr =~:
    Jump[Load] =~:
    EOS
  case CharF =&gt;
    DoubleHead =~:
    Push[I[1]] =~:
    AddInstr =~:
    DoubleHead =~:
    Push[I[1]] =~:
    AddInstr =~:
    Load =~:
    SecondToTop =~:
    Load =~:
    ThirdToTop =~:
    Load =~:
    AddInstr =~:
    AddInstr =~:
    SecondToTop =~:
    Store =~:
    Return =~:
    EOS
  case CharL =&gt;
    SecondToTop =~:
    Store =~:
    Return =~:
    EOS
  case _ =&gt;
    Leke[X]
type Leke[X] = X match
  case &quot;recurse-trampoline&quot; =&gt;
    Pop =~:
    Return =~:
    EOS
  case &quot;exception-landing-pad&quot; =&gt;
    Push[I[8]] =~:
    Push[I[42]] =~:
    Call[ThirdToTop] =~:
    Push[I[69]] =~:
    Push[I[42]] =~:
    Push[I[7]] =~:
    Call[&quot;main&quot;] =~:
    Push[I[0]] =~:
    Push[I[40]] =~:
    Push[I[32]] =~:
    Push[I[24]] =~:
    Push[I[29]] =~:
    Push[I[48]] =~:
    Push[I[65]] =~:
    Push[I[49]] =~:
    Push[I[40]] =~:
    Push[I[111]] =~:
    Call[Pop] =~:
    Push[I[69]] =~:
    Push[I[111]] =~:
    Push[I[7]] =~:
    Call[Load] =~:
    Push[I[1]] =~:
    SubInstr =~:
    JumpIfZero[OffBit] =~:
    Push[I[0]] =~:
    Exit =~:
    EOS
  case &quot;strlen&quot; =&gt;
    DoubleHead =~:
    Load =~:
    DoubleHead =~:
    JumpIfZero[SubInstr] =~:
    ThirdToTop =~:
    XorInstr =~:
    SecondToTop =~:
    Push[I[1]] =~:
    AddInstr =~:
    Jump[&quot;strlen&quot;] =~:
    EOS
  case &quot;stacktrace&quot; =&gt;
    Push[I[0]] =~:
    Push[I[42]] =~:
    Call[&quot;strlen&quot;] =~:
    Push[I[13]] =~:
    SubInstr =~:
    JumpIfZero[&quot;exception-landing-pad&quot;] =~:
    Push[I[0]] =~:
    Exit =~:
    EOS
  case &quot;main&quot; =&gt;
    DoubleHead =~:
    JumpIfZero[CharE] =~:
    ThirdToTop =~:
    DoubleHead =~:
    FourthToTop =~:
    DoubleHead =~:
    ThirdToTop =~:
    SecondToTop =~:
    Call[CharF] =~:
    Push[I[1]] =~:
    AddInstr =~:
    SecondToTop =~:
    Push[I[1]] =~:
    AddInstr =~:
    ThirdToTop =~:
    Push[I[1]] =~:
    SubInstr =~:
    ThirdToTop =~:
    SecondToTop =~:
    Jump[&quot;main&quot;] =~:
    EOS
  case _ =&gt;
    Laka[X]
  type Laka[X] = X match
  case SubInstr =&gt;
    Pop =~:
    Pop =~:
    Return =~:
    EOS
  case Pop =&gt;
    SecondToTop =~:
    DoubleHead =~:
    JumpIfZero[CharL] =~:
    SecondToTop =~:
    DoubleHead =~:
    ThirdToTop =~:
    SecondToTop =~:
    Store =~:
    Push[I[1]] =~:
    AddInstr =~:
    Jump[Pop] =~:
    EOS
  case Load =&gt;
    DoubleHead =~:
    JumpIfZero[EOS] =~:
    ThirdToTop =~:
    DoubleHead =~:
    Load =~:
    FourthToTop =~:
    DoubleHead =~:
    Load =~:
    ThirdToTop =~:
    SubInstr =~:
    JumpIfZero[CharP] =~:
    Pop =~:
    Pop =~:
    Pop =~:
    Push[I[0]] =~:
    Return =~:
    EOS
  case EOS =&gt;
    Pop =~:
    Pop =~:
    Pop =~:
    Push[I[1]] =~:
    Return =~:
    EOS
  case OffBit =&gt;
    Push[I[20]] =~:
    Exit =~:
    EOS


type GetNodeElement[T, N] = N match
  case EOS =&gt; T match
  case Node[x] =&gt; x
  case OffBit =~: bs =&gt; T match
  case Pair[l, r] =&gt; GetNodeElement[l, bs]
  case OnBit =~: bs =&gt; T match
  case Pair[l, r] =&gt; GetNodeElement[r, bs]

  sealed trait SecondToTop                   
  sealed trait ThirdToTop                    
  sealed trait FourthToTop  

  type =:=[X, Y] = X match
  case Y =&gt; Unit

class Magick[T]:
  type trick = T
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../LakeCTF2022/fun-type-system/part-1/section-6.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../LakeCTF2022/fun-type-system/part-2/intro.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../LakeCTF2022/fun-type-system/part-1/section-6.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../LakeCTF2022/fun-type-system/part-2/intro.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
